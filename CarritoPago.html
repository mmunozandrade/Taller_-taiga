<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pago del Pedido - Maniaterránia</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
        body { background-color: #f8f9fa; }
        .card { border-radius: 10px; }
    </style>
</head>
<body class="bg-light">
<nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="Inicio.html">
            <h2 class="mb-0">Meniaterránia</h2>
        </a>
        <div class="d-flex align-items-center">
            <a href="Inicio.html" class="nav-link text-white me-4 fw-semibold">
                <i class="bi bi-house-door-fill me-1"></i> Inicio
            </a>
            <a href="Carrito.html" class="nav-link text-white me-4 fw-semibold">
                <i class="bi bi-book-half me-1"></i> Menú
            </a>
            <a href="CarritoPago.html" class="nav-link text-white position-relative">
                <i class="bi bi-cart3" style="font-size:1.5rem;">Carrito</i>
                <span id="cart-count"
                    class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                    0
                </span>
            </a>
            <a href="Perfil.html" class="nav-link text-white me-3">
                <i class="bi bi-person-circle" style="font-size:1.5rem;"></i>
            </a>
            <a href="DatosCifrados.html" class="nav-link text-white me-4 fw-semibold">
                <i class="bi bi-book-half me-1"></i> Empleados
            </a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="row mb-3">
        <div class="col text-center">
            <h2>Confirmación y Pago</h2>
            <p class="text-muted mb-0">Revisa tu pedido y completa tus datos para finalizar la compra.</p>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-6 mb-3">
            <div class="card">
                <div class="card-header text-center">
                    <h5>Datos de contacto y entrega</h5>
                </div>
                <div class="card-body">
                    <form id="formPago">
                        <div class="mb-3">
                            <label class="form-label">Nombre completo</label>
                            <input type="text" class="form-control" id="nombre" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Teléfono</label>
                            <input type="tel" class="form-control" id="telefono" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Dirección</label>
                            <input type="text" class="form-control" id="direccion" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Método de pago</label>
                            <select id="metodoPago" class="form-select" required>
                                <option value="">Selecciona...</option>
                                <option value="tarjeta">Tarjeta de crédito / débito</option>
                                <option value="efectivo">Efectivo</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Comentarios adicionales (opcional)</label>
                            <textarea id="comentarios" class="form-control" rows="2"></textarea>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-5 mb-3">
            <div class="card">
                <div class="card-header text-center">
                    <h5>Resumen del Pedido</h5>
                </div>
                <div class="card-body">
                    <div id="resumenPedido">
                        <p class="text-muted text-center">Cargando tu carrito...</p>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between">
                        <strong>Total:</strong>
                        <strong id="totalPedido">$0</strong>
                    </div>

                    <!-- BOTÓN: sigue yendo a BoletaElectronica -->
                    <button id="btnConfirmarPago" class="btn btn-success w-100 mt-3">
                        Confirmar pedido y ver boleta electrónica
                    </button>

                    <button class="btn btn-outline-secondary w-100 mt-2"
                            onclick="window.location.href='Carrito.html'">
                        Volver al carrito
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<br><br>

<footer class="py-4 bg-dark text-white-50">
    <div class="container text-center small">
        <p>&copy; 2025 Maniaterránia. Todos los derechos reservados.</p>
    </div>
</footer>

<script>
    // Cargar carrito desde localStorage
    let carrito = JSON.parse(localStorage.getItem("carrito")) || {};
    const resumenPedido   = document.getElementById("resumenPedido");
    const totalPedido     = document.getElementById("totalPedido");
    const cartCount       = document.getElementById("cart-count");
    const btnConfirmarPago= document.getElementById("btnConfirmarPago");
    const selectMetodo    = document.getElementById("metodoPago");

    function formatPrice(n) {
        return '$' + n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    function cargarResumen() {
        resumenPedido.innerHTML = "";
        const productos = Object.keys(carrito);

        if (productos.length === 0) {
            resumenPedido.innerHTML = `<p class="text-muted text-center">
                Tu carrito está vacío. Vuelve al menú para agregar productos.
            </p>`;
            totalPedido.textContent = "$0";
            cartCount.textContent   = "0";
            btnConfirmarPago.disabled = true;
            return;
        }

        let total = 0;
        let totalItems = 0;

        productos.forEach(nombre => {
            const item = carrito[nombre];
            const subtotal = item.cantidad * item.precio;
            total      += subtotal;
            totalItems += item.cantidad;

            const row = document.createElement("div");
            row.classList.add("d-flex", "justify-content-between", "align-items-center", "mb-2");
            row.innerHTML = `<strong>${nombre}</strong> x ${item.cantidad}
                             <span>${formatPrice(subtotal)}</span>`;
            resumenPedido.appendChild(row);
        });

        resumenPedido.appendChild(document.createElement("hr"));
        const info = document.createElement("p");
        info.classList.add("mb-0", "text-muted");
        info.textContent = `Total de ítems: ${totalItems}`;
        resumenPedido.appendChild(info);

        totalPedido.textContent = formatPrice(total);
        cartCount.textContent   = totalItems.toString();
        btnConfirmarPago.disabled = false;
    }

    // Guardar datos del formulario en localStorage
    function guardarDatosPago() {
        const datosPago = {
            nombre: document.getElementById("nombre").value.trim(),
            telefono: document.getElementById("telefono").value.trim(),
            direccion: document.getElementById("direccion").value.trim(),
            metodoPago: document.getElementById("metodoPago").value,
            comentarios: document.getElementById("comentarios").value.trim()
        };
        localStorage.setItem("datosPago", JSON.stringify(datosPago));
        return datosPago;
    }

    // ⚡ Cuando cambia el método de pago
    selectMetodo.addEventListener("change", () => {
        if (selectMetodo.value === "tarjeta") {
            // Guardamos lo que haya escrito el usuario hasta ahora
            guardarDatosPago();
            // Redirigimos al centro de pago
            window.location.href = "centropago.html";
        }
    });
    // Botón: seguir flujo a BoletaElectronica (para efectivo u otros métodos)
    btnConfirmarPago.addEventListener("click", () => {
        guardarDatosPago();
        window.location.href = "BoletaElectronica.html";
    });
    cargarResumen();
</script>
</body>
</html>
